#!/bin/bash

pkgname='rtl8188eu'
version='5.2.2.4'
revision='1'
arch='armv7l'
depends=''

short_desc='Kernel module for rtl8188eu'
license='Proprietary'
homepage='https://github.com/lwfinger/rtl8188eu'

prepare() {
  # downloads source archive
  [ -f "${srcdir}/sources.zip" ] || curl \
    -o "${srcdir}/sources.zip" \
    -L 'https://github.com/lwfinger/rtl8188eu/archive/v5.2.2.4.zip'
}

package() {
  unzip -d "${pkgdir}" "${srcdir}/sources.zip"

  cd "${pkgdir}/rtl8188eu-"*
  mkdir .git

  kernel="$(uname -r)"
  make KVER="${kernel}" all

  install -Dm 644 "${pkgdir}/rtl8188eu-"*/8188eu.ko "${pkgdir}/usr/lib/modules/${kernel}/kernel/drivers/net/wireless"
  install -Dm 644 "${pkgdir}/rtl8188eu-"*/rtl8188eufw.bin "${pkgdir}/usr/lib/firmware/rtlwifi"
  install -Dm 644 "${srcdir}/blacklist.conf" "${pkgdir}/etc/modprobe.d/blacklist-r8188eu.conf"

  rm -rf "${pkgdir}/rtl8188eu-"*
}

